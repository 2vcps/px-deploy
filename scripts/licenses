if [ -z "$licenses" ]; then
  echo '$licenses is empty'
  exit
fi

for i in $licenses; do
  echo $i | grep -Eq '^[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}$'
  if [ $? -ne 0 ]; then
    echo "Licence '$i' is invalid"
        exit
  fi
done

for i in $licenses; do
  if [ "$operator" = false ]; then
    namespace=kube-system
  else
    namespace=portworx
  fi
  while ! kubectl exec -n $namespace -it $(kubectl get pods -n $namespace -lname=portworx --field-selector=status.phase=Running | tail -1 | cut -f 1 -d " ") -- /opt/pwx/bin/pxctl license activate $i; do
    sleep 1
  done
done
